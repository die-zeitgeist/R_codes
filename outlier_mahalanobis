# install.packages("robustbase")
library(robustbase)

# X: sadece sayısal sütunlardan oluşan veri (data.frame veya matrix)
X <- as.matrix(df_numeric)

# 1) Robust location + covariance (MCD)
fit <- covMcd(X)              # robust center & cov

mu_r <- fit$center
S_r  <- fit$cov

# 2) Robust Mahalanobis D^2
D2_robust <- mahalanobis(X, center = mu_r, cov = S_r)

# 3) p-değerleri (MVN varsayımı altında)
p <- ncol(X)
pval <- pchisq(D2_robust, df = p, lower.tail = FALSE)

# Sonuç
out <- data.frame(D2 = D2_robust, pval = pval)
out <- out[order(out$D2, decreasing = TRUE), ]
head(out, 20)   # en uç 20 birey
